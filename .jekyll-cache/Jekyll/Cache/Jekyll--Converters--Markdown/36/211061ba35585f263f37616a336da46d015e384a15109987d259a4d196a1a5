I"˜<p>â€œWhen you bow deeply to the universe, it bows back; when you call out the name of God, it echoes inside you.â€
â€•Morihei Ueshiba</p>

<h1 id="thread">Thread</h1>

<h3 id="creation">Creation</h3>
<p>There is 1 way to create a Thread but task can be assigned to Thread using 3 different ways either by using.</p>
<ul>
  <li>Runnable interface (run() method will be invoked)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">ThreadDemo</span><span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//Lets create Task first to assign it to the Thread</span>
        <span class="nc">ThreadTask</span> <span class="n">threadTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadTask</span><span class="o">();</span>
        <span class="c1">//Lets create a Thread and assign task to it.</span>
        <span class="c1">//Way to assign task to a Thread is by passing task object(Runnable) to Thread's constructor.</span>
        <span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">threadTask</span><span class="o">);</span>
        <span class="c1">//Start a thread</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">ThreadTask</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="c1">//Code present here will be executed in separate independent path.</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>Thread class (run() method will be invoked)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadDemo2</span>  <span class="kd">extends</span> <span class="nc">Thread</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//Code present here will be executed in separate independent path.</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//Lets create Task first to assign it to the Thread</span>
        <span class="nc">ThreadDemo2</span> <span class="n">threadTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadDemo2</span><span class="o">();</span>
        <span class="c1">//Lets create a Thread and assign task to it.</span>
        <span class="c1">//Way to assign task to a Thread is by passing task object(Runnable) to Thread's constructor.</span>
        <span class="nc">Thread</span> <span class="n">thread1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Thread</span><span class="o">(</span><span class="n">threadTask</span><span class="o">);</span>
        <span class="c1">//Start a thread</span>
        <span class="n">thread1</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>Callable interface (call() method will be invoked)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadDemo3</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ExecutorService</span> <span class="n">executorService</span> <span class="o">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="nc">ThreadTask</span> <span class="n">threadTask</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadTask</span><span class="o">();</span>
        <span class="nc">Future</span><span class="o">&lt;</span><span class="nc">Result</span><span class="o">&gt;</span> <span class="n">resultObject</span> <span class="o">=</span> <span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">threadTask</span><span class="o">);</span>
        <span class="nc">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">resultObject</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">code</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">message</span><span class="o">);</span>
        <span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">ThreadTask</span> <span class="kd">implements</span> <span class="nc">Callable</span><span class="o">&lt;</span><span class="nc">Result</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nc">Result</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
            <span class="nc">Result</span> <span class="n">response</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Result</span><span class="o">();</span>
            <span class="n">response</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="mi">200</span><span class="o">;</span>
            <span class="n">response</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="s">"SUCCESS"</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Result</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">code</span><span class="o">;</span>
        <span class="kd">public</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="synchronized">synchronized</h3>
<ul>
  <li>
    <p>æ–¹æ³•å£°æ˜æ—¶ä½¿ç”¨,æ”¾åœ¨èŒƒå›´æ“ä½œç¬¦(publicç­‰)ä¹‹å,è¿”å›ç±»å‹å£°æ˜(voidç­‰)ä¹‹å‰.
å³ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥æ–¹æ³•,å…¶ä»–çº¿ç¨‹è¦æƒ³åœ¨æ­¤æ—¶è°ƒç”¨è¯¥æ–¹æ³•,åªèƒ½æ’é˜Ÿç­‰å€™,å½“å‰çº¿ç¨‹(å°±æ˜¯åœ¨synchronizedæ–¹æ³•å†…éƒ¨çš„çº¿ç¨‹)æ‰§è¡Œå®Œè¯¥æ–¹æ³•å,åˆ«çš„çº¿ç¨‹æ‰èƒ½è¿›å…¥.</p>
  </li>
  <li>
    <p>å¯¹æŸä¸€ä»£ç å—ä½¿ç”¨,
synchronizedåè·Ÿæ‹¬å·,æ‹¬å·é‡Œæ˜¯å˜é‡,è¿™æ ·,ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥è¯¥ä»£ç å—</p>
  </li>
  <li>
    <p>synchronizedåé¢æ‹¬å·é‡Œæ˜¯ä¸€å¯¹è±¡,
æ­¤æ—¶,çº¿ç¨‹è·å¾—çš„æ˜¯å¯¹è±¡é”.å¦‚æœçº¿ç¨‹è¿›å…¥,åˆ™å¾—åˆ°å¯¹è±¡é”,é‚£ä¹ˆåˆ«çš„çº¿ç¨‹åœ¨è¯¥ç±»æ‰€æœ‰å¯¹è±¡ä¸Šçš„ä»»ä½•æ“ä½œéƒ½ä¸èƒ½è¿›è¡Œ.åœ¨å¯¹è±¡çº§ä½¿ç”¨é”é€šå¸¸æ˜¯ä¸€ç§æ¯”è¾ƒç²—ç³™çš„æ–¹æ³•</p>
  </li>
  <li>
    <p>synchronizedåé¢æ‹¬å·é‡Œæ˜¯ç±», å¦‚ï¼Œ</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>synchronized(ArrayWithLockOrder.class)
</pre></td></tr></tbody></table></code></pre></div>    </div>
    <p>å¦‚æœçº¿ç¨‹è¿›å…¥,åˆ™çº¿ç¨‹åœ¨è¯¥ç±»ä¸­æ‰€æœ‰æ“ä½œä¸èƒ½è¿›è¡Œ,åŒ…æ‹¬é™æ€å˜é‡å’Œé™æ€æ–¹æ³•</p>
  </li>
</ul>

<h3 id="é”å’Œå¯¹è±¡çš„å…³ç³»">é”å’Œå¯¹è±¡çš„å…³ç³»</h3>
<ul>
  <li>é”æ˜¯å’Œå¯¹è±¡ç›¸å…³è”çš„ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰ä¸€æŠŠé”ï¼Œä¸ºäº†æ‰§è¡Œsynchronizedè¯­å¥ï¼Œçº¿ç¨‹å¿…é¡»èƒ½å¤Ÿè·å¾—synchronizedè¯­å¥ä¸­è¡¨è¾¾å¼æŒ‡å®šçš„å¯¹è±¡çš„é”ï¼Œ</li>
  <li>ä¸€ä¸ªå¯¹è±¡åªæœ‰ä¸€æŠŠé”ï¼Œè¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ä¹‹åå®ƒå°±ä¸å†æ‹¥æœ‰è¿™æŠŠé”ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œå®Œsynchronizedè¯­å¥åï¼Œå°†è·å¾—é”äº¤è¿˜ç»™å¯¹è±¡ã€‚</li>
  <li>åœ¨æ–¹æ³•å‰é¢åŠ ä¸Šsynchronizedä¿®é¥°ç¬¦å³å¯ä»¥å°†ä¸€ä¸ªæ–¹æ³•å£°æ˜ä¸ºåŒæ­¥åŒ–æ–¹æ³•ã€‚åŒæ­¥åŒ–æ–¹æ³•åœ¨æ‰§è¡Œä¹‹å‰è·å¾—ä¸€ä¸ªé”ã€‚</li>
  <li>åœ¨ç±»æ–¹æ³•å‰é¢åŠ ä¸Šsynchronizedï¼Œé‚£ä¹ˆè·å¾—çš„é”æ˜¯å’Œå£°æ˜æ–¹æ³•çš„ç±»ç›¸å…³çš„Classç±»å¯¹è±¡çš„é”ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤é”æ˜¯thiså¯¹è±¡çš„é”ã€‚</li>
</ul>

<h3 id="notify-notifyall">notify, notifyAll</h3>
<ul>
  <li>wait()ã€notify()å’ŒnotifyAll()æ–¹æ³•æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œå¹¶ä¸”ä¸ºfinalæ–¹æ³•ï¼Œæ— æ³•è¢«é‡å†™ã€‚</li>
  <li>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•èƒ½è®©å½“å‰çº¿ç¨‹é˜»å¡ï¼Œå¹¶ä¸”å½“å‰çº¿ç¨‹å¿…é¡»æ‹¥æœ‰æ­¤å¯¹è±¡çš„monitorï¼ˆå³é”ï¼‰</li>
  <li>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„notify()æ–¹æ³•èƒ½å¤Ÿå”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorï¼Œåˆ™åªèƒ½å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼›</li>
  <li>è°ƒç”¨notifyAll()æ–¹æ³•èƒ½å¤Ÿå”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¿™ä¸ªå¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼›</li>
</ul>

<p>Warning:
å•ä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä½¿ç”¨notifyæ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯å¤šä¸ªçš„æ—¶å€™éƒ½è¦ä½¿ç”¨notifyAll</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Clearly, notify wakes (any) one thread in the wait set, notifyAll wakes all threads in the waiting set.
</pre></td></tr></tbody></table></code></pre></div></div>
<p>æç«¯æƒ…å†µä¸‹ï¼Œ ä»…ä»…è°ƒç”¨notify()ä¼šå¯¼è‡´æ­»é”</p>

<h3 id="waitnotifyå’Œnotifyallæ–¹æ³•æ˜¯objectç±»ä¸­å£°æ˜çš„æ–¹æ³•">wait()ã€notify()å’ŒnotifyAll()æ–¹æ³•æ˜¯Objectç±»ä¸­å£°æ˜çš„æ–¹æ³•</h3>
<p>ä¸ºä½•è¿™ä¸‰ä¸ªä¸æ˜¯Threadç±»å£°æ˜ä¸­çš„æ–¹æ³•?
å…¶å®è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œ</p>
<ul>
  <li>ç”±äºæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰monitorï¼ˆå³é”ï¼‰ï¼Œæ‰€ä»¥è®©å½“å‰çº¿ç¨‹ç­‰å¾…æŸä¸ªå¯¹è±¡çš„é”ï¼Œå½“ç„¶åº”è¯¥é€šè¿‡è¿™ä¸ªå¯¹è±¡æ¥æ“ä½œäº†ã€‚</li>
  <li>å½“å‰çº¿ç¨‹å¯èƒ½ä¼šç­‰å¾…å¤šä¸ªçº¿ç¨‹çš„é”ï¼Œå¦‚æœé€šè¿‡çº¿ç¨‹æ¥æ“ä½œï¼Œå°±éå¸¸å¤æ‚äº†ã€‚</li>
  <li>å¦‚æœè°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡çš„monitorï¼ˆå³é”ï¼‰ï¼Œå› æ­¤è°ƒç”¨wait()æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­è¿›è¡Œï¼ˆsynchronizedå—æˆ–è€…synchronizedæ–¹æ³•ï¼‰ã€‚</li>
  <li>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„wait()æ–¹æ³•ï¼Œç›¸å½“äºè®©å½“å‰çº¿ç¨‹äº¤å‡ºæ­¤å¯¹è±¡çš„monitorï¼Œç„¶åè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…åç»­å†æ¬¡è·å¾—æ­¤å¯¹è±¡çš„é”(Threadç±»ä¸­çš„sleepæ–¹æ³•ä½¿å½“å‰çº¿ç¨‹æš‚åœæ‰§è¡Œä¸€æ®µæ—¶é—´ï¼Œä»è€Œè®©å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šç»§ç»­æ‰§è¡Œï¼Œä½†å®ƒå¹¶ä¸é‡Šæ”¾å¯¹è±¡é”)</li>
  <li>notify()æ–¹æ³•èƒ½å¤Ÿå”¤é†’ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è¯¥å¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹éƒ½åœ¨ç­‰å¾…è¯¥å¯¹è±¡çš„monitorçš„è¯ï¼Œåˆ™åªèƒ½å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œå…·ä½“å”¤é†’å“ªä¸ªçº¿ç¨‹åˆ™ä¸å¾—è€ŒçŸ¥ã€‚</li>
  <li>è°ƒç”¨æŸä¸ªå¯¹è±¡çš„notify()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹ä¹Ÿå¿…é¡»æ‹¥æœ‰è¿™ä¸ªå¯¹è±¡çš„monitorï¼Œå› æ­¤è°ƒç”¨notify()æ–¹æ³•å¿…é¡»åœ¨åŒæ­¥å—æˆ–è€…åŒæ­¥æ–¹æ³•ä¸­è¿›è¡Œï¼ˆsynchronizedå—æˆ–è€…synchronizedæ–¹æ³•ï¼‰ã€‚</li>
  <li>nofityAll()æ–¹æ³•èƒ½å¤Ÿå”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…è¯¥å¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œè¿™ä¸€ç‚¹ä¸notify()æ–¹æ³•æ˜¯ä¸åŒçš„ã€‚
è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼šnotify()å’ŒnotifyAll()æ–¹æ³•åªæ˜¯å”¤é†’ç­‰å¾…è¯¥å¯¹è±¡çš„monitorçš„çº¿ç¨‹ï¼Œå¹¶ä¸å†³å®šå“ªä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–åˆ°monitorã€‚
ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’ä¸ä»£è¡¨ç«‹å³è·å–äº†å¯¹è±¡çš„monitorï¼Œåªæœ‰ç­‰è°ƒç”¨å®Œnotify()æˆ–è€…notifyAll()å¹¶é€€å‡ºsynchronizedå—ï¼Œé‡Šæ”¾å¯¹è±¡é”åï¼Œå…¶ä½™çº¿ç¨‹æ‰å¯è·å¾—é”æ‰§è¡Œã€‚</li>
</ul>

<h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜">ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</h3>

<ul>
  <li>use BlockQueue</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UseBlockQueue</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TAG</span> <span class="o">=</span> <span class="nc">UseBlockQueue</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nf">UseBlockQueue</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Producer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Consumer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">UseBlockQueue</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UseBlockQueue</span><span class="o">();</span>
        <span class="n">test</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span> <span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
                    <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"Producer: "</span> <span class="o">+</span> <span class="n">o</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"producer is interrupted!"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span> <span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"Consumer: "</span> <span class="o">+</span> <span class="n">o</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ie</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"consumer is interrupted!"</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>use ReEntrantLock</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UseReentrantLock</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TAG</span> <span class="o">=</span> <span class="nc">UseReentrantLock</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">myList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="no">MAX</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Lock</span> <span class="n">lock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ReentrantLock</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Condition</span> <span class="n">full</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Condition</span> <span class="n">empty</span> <span class="o">=</span> <span class="n">lock</span><span class="o">.</span><span class="na">newCondition</span><span class="o">();</span>
    <span class="kd">public</span> <span class="nf">UseReentrantLock</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Producer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Consumer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">UseReentrantLock</span> <span class="n">test</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UseReentrantLock</span><span class="o">();</span>
        <span class="n">test</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">while</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="no">MAX</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"warning: list is full"</span><span class="o">);</span>
                        <span class="n">full</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span>
                    <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">o</span><span class="o">))</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"Producer: "</span> <span class="o">+</span> <span class="n">o</span><span class="o">);</span>
                        <span class="n">empty</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ie</span><span class="o">){</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"producer is interrupted!"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">lock</span><span class="o">.</span><span class="na">lock</span><span class="o">();</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">while</span> <span class="o">(</span><span class="n">myList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"warning: it's empty!"</span><span class="o">);</span>
                        <span class="n">empty</span><span class="o">.</span><span class="na">await</span><span class="o">();</span>
                    <span class="o">}</span>
                    <span class="nc">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">myList</span><span class="o">.</span><span class="na">removeLast</span><span class="o">();</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"Consumer: "</span> <span class="o">+</span> <span class="n">o</span><span class="o">);</span>
                    <span class="n">full</span><span class="o">.</span><span class="na">signal</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">ie</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span><span class="s">"consumer is interrpted!"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">lock</span><span class="o">.</span><span class="na">unlock</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>use wait notify</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UseWaitNotify</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">TAG</span> <span class="o">=</span> <span class="nc">UseWaitNotify</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="kd">private</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">storeHouse</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">&gt;();</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="kt">int</span> <span class="no">MAX</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">UseWaitNotify</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">new</span> <span class="nf">Producer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
        <span class="k">new</span> <span class="nf">Consumer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Producer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">storeHouse</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">while</span> <span class="o">(</span><span class="n">storeHouse</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="no">MAX</span><span class="o">)</span> <span class="o">{</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"storeHouse is full , plz wait"</span><span class="o">);</span>
                            <span class="n">storeHouse</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                        <span class="o">}</span>
                        <span class="nc">Object</span> <span class="n">newObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">();</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">storeHouse</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">newObject</span><span class="o">))</span> <span class="o">{</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Producer put a Object to storeHouse"</span><span class="o">);</span>
                            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()*</span><span class="mi">3000</span><span class="o">));</span>
                            <span class="n">storeHouse</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Producer is interrupted"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">class</span> <span class="nc">Consumer</span> <span class="kd">extends</span> <span class="nc">Thread</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
                <span class="kd">synchronized</span> <span class="o">(</span><span class="n">storeHouse</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">while</span> <span class="o">(</span><span class="n">storeHouse</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"storehouse is empty, plz wait"</span><span class="o">);</span>
                            <span class="n">storeHouse</span><span class="o">.</span><span class="na">wait</span><span class="o">();</span>
                        <span class="o">}</span>
                        <span class="n">storeHouse</span><span class="o">.</span><span class="na">removeLast</span><span class="o">();</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"consumer get a object from storehouse"</span><span class="o">);</span>
                        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">((</span><span class="kt">long</span><span class="o">)</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">3000</span><span class="o">));</span>
                        <span class="n">storeHouse</span><span class="o">.</span><span class="na">notify</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Producer is interrupted"</span><span class="o">);</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">UseWaitNotify</span> <span class="n">use</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UseWaitNotify</span><span class="o">();</span>
        <span class="n">use</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
:ET